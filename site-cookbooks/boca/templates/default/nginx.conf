server {
	listen 80;
	listen 443 ssl;

	ssl_certificate /etc/ssl/nginx/boca-app.com.crt;
	ssl_certificate_key /etc/ssl/nginx/boca-app.com.key;

	rewrite ^(.*) https://www.boca-app.com$1 permanent;
}

server {
	listen 443 ssl;

	server_name www.boca-app.com;
	root /var/www/localhost/htdocs;

	ssl_certificate /etc/ssl/nginx/boca-app.com.crt;
	ssl_certificate_key /etc/ssl/nginx/boca-app.com.key;

	index index.html index.php;
	fastcgi_index index.php;

	log_not_found off;

	location ~ ^/admin/.*\.php {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/boca.passwd;
		include /etc/nginx/modules/fastcgi.conf;
		fastcgi_pass unix:/var/run/php-fpm/nginx.socket;
	}

	location ~ ^/admin/ {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/boca.passwd;
	}

	location ~ ^/admintest/.*\.php {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/boca.passwd;
		include /etc/nginx/modules/fastcgi.conf;
		fastcgi_pass unix:/var/run/php-fpm/nginx.socket;
	}

	location ~ ^/admintest/ {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/boca.passwd;
	}

	location ~ ^/apitest/.*\.php {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/boca.passwd;
		include /etc/nginx/modules/fastcgi.conf;
		fastcgi_pass unix:/var/run/php-fpm/nginx.socket;
	}

	location ~ ^/apitest/ {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/boca.passwd;
	}

	location ~ ^/website/unternehmen/.*\.php {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/boca.passwd;
		include /etc/nginx/modules/fastcgi.conf;
		fastcgi_pass unix:/var/run/php-fpm/nginx.socket;
	}

	location ~ ^/website/unternehmen/ {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/boca.passwd;
	}

	location ~ ^/website/webtest/.*\.php {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/webtest.passwd;
		include /etc/nginx/modules/fastcgi.conf;
		fastcgi_pass unix:/var/run/php-fpm/nginx.socket;
	}

	location ~ ^/website/webtest/ {
		auth_basic "restricted";
		auth_basic_user_file /etc/nginx/servers/webtest.passwd;
		try_files $uri $uri/ @webtest;
	}

	location @webtest {
		rewrite ^(.*[^/])$ $1/ permanent;
		include /etc/nginx/modules/fastcgi.conf;
		fastcgi_param SCRIPT_FILENAME $document_root/website/webtest/index.php;
		fastcgi_pass unix:/var/run/php-fpm/nginx.socket;
	}

	location ~ ^/website/web/.*\.php {
		include /etc/nginx/modules/fastcgi.conf;
		fastcgi_pass unix:/var/run/php-fpm/nginx.socket;
	}

	location ~ ^/website/web/ {
		try_files $uri $uri/ @web;
	}

	location @web {
		rewrite ^(.*[^/])$ $1/ permanent;
		include /etc/nginx/modules/fastcgi.conf;
		fastcgi_param SCRIPT_FILENAME $document_root/website/web/index.php;
		fastcgi_pass unix:/var/run/php-fpm/nginx.socket;
	}

	include /etc/nginx/php.conf;

	location / {
		index index.php;
		try_files $uri $uri/ @php;
	}

	location @php {
		include /etc/nginx/modules/fastcgi.conf;
		fastcgi_pass unix:/var/run/php-fpm/nginx.socket;
	}
}

# vim: ft=nginx
